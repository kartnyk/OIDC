Here's a general PlantUML sequence diagram for a basic SAML authentication flow, covering the primary steps in both SP-initiated and IdP-initiated SAML authentication. This will help illustrate the core components and interactions in a typical SAML-based Single Sign-On (SSO) scenario.

PlantUML Code for General SAML Authentication Flow

@startuml
skinparam backgroundColor #F9F9F9
skinparam shadowing true
skinparam arrowColor #172B4D
skinparam actorBorderColor #172B4D
skinparam actorBackgroundColor #172B4D
skinparam participantBorderColor #172B4D
skinparam participantBackgroundColor #B3C3D3
skinparam sequenceArrowThickness 2

actor User #172B4D
participant "Service Provider (SP)" as SP #B3C3D3
participant "Identity Provider (IdP)" as IdP #B3C3D3

== SP-Initiated SAML Authentication Flow ==

User -> SP: Access Protected Resource
SP -> IdP: Redirect User to IdP with AuthnRequest
note right of IdP: IdP receives AuthnRequest\nfrom SP to authenticate user

User -> IdP: Authenticate at IdP\n(e.g., login with username/password)
IdP -> IdP: Validate User Credentials
IdP -> User: Redirect User back to SP with SAML Response

User -> SP: Access SP with SAML Response

== SP Verifies SAML Assertion ==

SP -> SP: Validate SAML Response\n(Signature, Audience, Issuer, Conditions)
alt If Assertion is Valid
    SP -> User: Grant Access to Protected Resource
else If Assertion is Invalid
    SP -> User: Deny Access
end

== IdP-Initiated SAML Authentication Flow ==

User -> IdP: Log in to IdP Portal
IdP -> IdP: Authenticate User
User -> IdP: Select SP from IdP Portal

IdP -> User: Redirect to SP with SAML Response
note left of User: User is redirected to SP\nwith the SAML Response

User -> SP: Access SP with SAML Response

SP -> SP: Validate SAML Response\n(Signature, Audience, Issuer, Conditions)

Explanation of the General SAML Authentication Flow

1. SP-Initiated Flow:

The user tries to access a protected resource at the SP.

The SP redirects the user to the IdP with an authentication request (AuthnRequest).

The user authenticates at the IdP (e.g., logs in with a username and password).

The IdP generates a SAML assertion, included in a SAML response, and redirects the user back to the SP.

The user presents the SAML response to the SP, which verifies the assertion’s validity (checking the signature, issuer, audience, and conditions).

If valid, the SP grants access; if invalid, the SP denies access.



2. IdP-Initiated Flow:

The user logs into the IdP’s portal.

After successful authentication, the user selects the SP they want to access.

The IdP generates a SAML response with an assertion and redirects the user to the SP.

The user presents the SAML response to the SP, which validates the assertion.

If the assertion is valid, access is granted; if not, access is denied.




Key Steps Explained

Authentication Request: In SP-initiated SSO, the SP creates an AuthnRequest to request authentication from the IdP.

User Authentication: The IdP verifies the user's identity using credentials or another authentication method.

SAML Assertion: The IdP issues a signed SAML assertion containing the user's identity information.

Validation: The SP validates the SAML assertion to confirm its integrity and authenticity.

Access Control: The SP grants or denies access based on the validity of the SAML assertion.


This sequence diagram captures the essentials of SAML authentication, providing a clear visual guide for understanding the general flow of both SP-initiated and IdP-initiated SSO. Let me know if you need any customizations for specific use cases!
