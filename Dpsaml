@startuml
actor User
participant "AuthD (IdP)" as IdP
participant "DPSAML" as DPSAML
participant "PayPal (SP)" as SP

== User Login and SP Selection ==

User -> IdP: Access AuthD Portal and Login
IdP -> IdP: Validate User Credentials

User -> IdP: Select PayPal (SP) from AuthD Portal

== Client ID and Secret Validation ==

IdP -> IdP: Retrieve PayPal's client ID and client secret from config
IdP -> IdP: Validate client ID and client secret\nagainst database entry for PayPal

alt If Validation Fails
    IdP -> User: Access Denied
else If Validation Succeeds
    IdP -> DPSAML: Request SAML Assertion for PayPal
    note right of DPSAML: AuthD sends API key\nor mTLS certificate for authentication
end

== DPSAML Generates SAML Assertion ==

DPSAML -> DPSAML: Validate API Key or mTLS certificate
DPSAML -> IdP: Return signed SAML assertion for PayPal

== Redirect to SP with SAML Assertion ==

IdP -> User: Redirect to PayPal ACS URL\nwith SAML Assertion
User -> SP: Access PayPal ACS URL\nwith SAML Assertion

== PayPal Validates and Grants Access ==

SP -> SP: Verify SAML Assertion\n(Signature, Audience, Issuer, Conditions, Recipient)
SP -> User: Grant Access to PayPal

@enduml



@startuml
actor User
participant "AuthD (IdP)" as IdP
participant "DPSAML" as DPSAML
participant "PayPal (SP)" as SP

== Service Provider (SP) Registration ==

User -> IdP: Initiate SP Registration for PayPal
IdP -> IdP: Generate Client ID and Client Secret for PayPal

== Store Metadata and Credentials ==

IdP -> IdP: Store PayPal metadata\n(Entity ID, ACS URL, Public Key)
IdP -> IdP: Store Client ID and Client Secret\nfor PayPal in the database

== Configure DPSAML Access ==

IdP -> DPSAML: Register PayPal as SP\nwith DPSAML
note right of DPSAML: Configure DPSAML to allow\nonly AuthD access for PayPal requests
DPSAML -> IdP: Confirm Access Configuration

== Configure Client Credentials ==

alt Configure in AuthDâ€™s Config File
    IdP -> IdP: Update AuthD configuration file\nwith PayPal's Client ID and Secret
else Provide to User
    IdP -> User: Provide Client ID and Secret\nfor configuring in PayPal (SP)
end

== Completion of Registration ==

User -> SP: Configure PayPal with Client ID and Client Secret

@enduml
