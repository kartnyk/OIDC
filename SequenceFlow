@startuml
!define RECTANGLE class
skinparam RECTANGLE {
    BackgroundColor #D3E4CD
    BorderColor Black
    BorderThickness 1
    RoundCorner 10
}

actor User

RECTANGLE AngularFrontend {
    :http://localhost:4200;
}

RECTANGLE OAuth2OIDCServer {
    :Spring Boot Backend;
    :http://localhost:8082;
}

RECTANGLE ApplicationBackend {
    :Spring Boot Application Logic;
    :http://localhost:8081;
}

RECTANGLE GoogleAuthServer {
    :Google OAuth2 Authorization Server;
    :https://accounts.google.com;
}

User --> AngularFrontend : Clicks "Sign in with Google"
AngularFrontend --> OAuth2OIDCServer : GET /oauth2/authorize/google\n?redirect_uri=http://localhost:4200/oauth2/google/redirect
OAuth2OIDCServer --> GoogleAuthServer : Redirect to Google OAuth2\nwith client_id, redirect_uri, etc.
GoogleAuthServer --> User : Google Login Page
User --> GoogleAuthServer : Provides Credentials & Grants Consent
GoogleAuthServer --> OAuth2OIDCServer : Redirect with Authorization Code\n(code, state)
OAuth2OIDCServer --> GoogleAuthServer : POST /token\n(Exchange code for tokens)
GoogleAuthServer --> OAuth2OIDCServer : Returns Access Token, ID Token
OAuth2OIDCServer --> AngularFrontend : Redirect with JWT\n/token=<APPLICATION_JWT>
AngularFrontend --> ApplicationBackend : POST /login?token=<APPLICATION_JWT>
ApplicationBackend --> AngularFrontend : Returns User Info\nand/or Session Tokens

@enduml
